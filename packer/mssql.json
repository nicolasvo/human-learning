{
    "builders": [
        {
            "type": "hyperv-vmcx",
            "name": "hyperv",
            "vm_name": "packer-{{user `build_name`}}",
            "output_directory": "output-HyperV-{{user `build_name`}}",
            "clone_from_vmcx_path": "output-HyperV-{{user `base_name`}}",
            "generation": 2,
            "secondary_iso_images": [
                "{{ user `mssql_iso_path`}}"
            ],
            "boot_wait": "0s",
            "communicator": "winrm",
            "configuration_version": "9.0",
            "cpus": "{{user `cpus`}}",
            "memory": "{{user `memory`}}",
            "differencing_disk": true,
            "copy_in_compare": true,
            "enable_secure_boot": true,
            "guest_additions_mode": "disable",
            "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
            "switch_name": "{{user `hyperv_switchname`}}",
            "headless": "{{user `headless`}}",
            "winrm_timeout": "{{user `winrm_timeout`}}",
            "winrm_username": "administrator",
            "winrm_password": "{{user `admin_password`}}"
        },
        {
            "type": "vmware-vmx",
            "name": "vmware",
            "display_name": "{{user `build_name`}}",
            "output_directory": "output-VMWare-{{user `build_name`}}",
            "source_path": "./output-VMWare-{{user `base_name`}}/{{user `base_name`}}.vmx",
            "boot_wait": "15s",
            "communicator": "winrm",
            "headless": "{{user `headless`}}",
            "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
            "shutdown_timeout": "{{user `shutdown_timeout`}}",
            "vm_name": "{{user `build_name`}}",
            "vmx_data": {
                "ide0:0.clientdevice": "FALSE",
                "ide0:0.present": "TRUE",
                "ide0:0.devicetype": "cdrom-image",
                "ide0:0.filename": "{{pwd}}\\{{user `mssql_iso_path`}}",
                "RemoteDisplay.vnc.enabled": "false",
                "RemoteDisplay.vnc.port": "5900",
                "vhv.enable": "{{user `vhv_enable`}}",
                "ethernet0.connectiontype": "nat",
                "ethernet0.present": "TRUE",
                "ethernet0.virtualdev": "vmxnet3"
            },
            "vmx_data_post": {
                "ide0:0.present": "FALSE"
            },
            "vmx_remove_ethernet_interfaces": false,
            "vnc_port_max": 5980,
            "vnc_port_min": 5900,
            "winrm_timeout": "{{user `winrm_timeout`}}",
            "winrm_username": "administrator",
            "winrm_password": "{{user `admin_password`}}"
        }
    ],
    "post-processors": [],
    "provisioners": [
        {
            "elevated_user": "administrator",
            "elevated_password": "{{user `admin_password`}}",
            "environment_vars": [
                "SA_PASSWORD={{user `sa_password`}}",
                "ACCEPT_EULA=Y"
            ],
            "scripts": [
                "./mssql/scripts/setup-mssql.ps1"
            ],
            "type": "powershell"
        }
    ],
    "variables": {
        "build_name": "WinSrv2019DCCore-BASE-MSSQL",
        "base_name": "WinSrv2019DCCore-BASE",
        "winrm_timeout": "6h",
        "shutdown_timeout": "1h",
        "hyperv_switchname": "Default Switch",
        "memory": "2048",
        "cpus": "1",
        "headless": "false",
        "vhv_enable": "false",
        "mssql_iso_path": ".\\mssql\\iso\\SQLServer2017-x64-ENU-Dev.iso",
        "sa_password": "R00tR00t",
        "admin_password": null
    }
}